<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>芒果訂單表</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #fff8e7; }
        h1 { color: #f16c00; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #f2a654; padding: 10px; text-align: center; }
        th { background-color: #f2a654; color: white; }
        input[type="text"], input[type="number"] { padding: 5px; width: 150px; }
        button { padding: 5px 10px; margin-left: 5px; background-color: #f2a654; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #d97e3f; }
        #totalAmount { margin-top: 15px; font-weight: bold; font-size: 18px; }
        .input-container { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>芒果訂單表</h1>
    <div class="input-container">
        <label>姓名: <input type="text" id="name"></label>
        <label>數量: <input type="number" id="quantity" min="1"></label>
        <button onclick="addOrder()">新增訂單</button>
        <button onclick="exportCSV()">匯出 CSV</button>
    </div>

    <table id="orderTable">
        <thead>
            <tr>
                <th>姓名</th>
                <th>數量</th>
                <th>單價</th>
                <th>總價</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div id="totalAmount">總金額：0 元</div>

    <script>
        const unitPrice = 50; // 每顆芒果單價
        let orders = [];

        // 初始化讀取 LocalStorage
        window.onload = function() {
            const savedOrders = localStorage.getItem('mangoOrders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
                renderTable();
            }
        }

        function addOrder() {
            const name = document.getElementById('name').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value);

            if (!name || !quantity || quantity <= 0) {
                alert('請輸入有效的姓名和數量！');
                return;
            }

            const total = quantity * unitPrice;
            orders.push({ name, quantity, total });
            saveOrders();
            renderTable();

            document.getElementById('name').value = '';
            document.getElementById('quantity').value = '';
        }

        function deleteOrder(index) {
            if (confirm('確定要刪除這筆訂單嗎？')) {
                orders.splice(index, 1);
                saveOrders();
                renderTable();
            }
        }

        function renderTable() {
            const tbody = document.getElementById('orderTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            let sum = 0;

            orders.forEach((order, index) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = order.name;
                row.insertCell(1).textContent = order.quantity;
                row.insertCell(2).textContent = unitPrice;
                row.insertCell(3).textContent = order.total;
                const actionCell = row.insertCell(4);
                const delBtn = document.createElement('button');
                delBtn.textContent = '刪除';
                delBtn.onclick = () => deleteOrder(index);
                actionCell.appendChild(delBtn);

                sum += order.total;
            });

            document.getElementById('totalAmount').textContent = '總金額：' + sum + ' 元';
        }

        function saveOrders() {
            localStorage.setItem('mangoOrders', JSON.stringify(orders));
        }

        // 匯出 CSV
        function exportCSV() {
            if (orders.length === 0) {
                alert('目前沒有訂單可匯出！');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "姓名,數量,單價,總價\n";
            orders.forEach(order => {
                csvContent += `${order.name},${order.quantity},${unitPrice},${order.total}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            const date = new Date().toISOString().slice(0,10);
            link.setAttribute("download", `芒果訂單_${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>

